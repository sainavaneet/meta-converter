<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>iPhone 15 Pro Max EXIF Embedder</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 2rem; }
    .card { max-width: 720px; margin: auto; border: 1px solid #ddd; border-radius: 12px; padding: 1.5rem; box-shadow: 0 2px 6px rgba(0,0,0,.05); }
    label { display:block; margin-top: 1rem; font-weight: 600; }
    input[type="text"] { width: 100%; padding: .5rem; border: 1px solid #ccc; border-radius: 8px; }
    #preview { max-width: 100%; margin-top: 1rem; border-radius: 8px; }
    button { margin-top: 1rem; padding: .75rem 1rem; border: 0; border-radius: 10px; cursor: pointer; }
    .primary { background: black; color: white; }
    .muted { color: #666; font-size: .9rem; }
    footer { text-align:center; margin-top: 2rem; color:#777; }
    .row { display:flex; gap: 1rem; }
    .row > div { flex:1; }
  </style>
  <!-- piexifjs: client-side EXIF editing for JPEG -->
  <script src="https://cdn.jsdelivr.net/npm/piexifjs"></script>
</head>
<body>
  <div class="card">
    <h2>Embed iPhone 15 Pro Max EXIF</h2>
    <p class="muted">Upload a JPEG. This page will add EXIF fields (Make/Model/LensModel) entirely in your browser—no server upload.</p>

    <label>Choose JPEG image</label>
    <input id="fileInput" type="file" accept="image/jpeg,image/jpg" />

    <div class="row">
      <div>
        <label>Make</label>
        <input id="make" value="Apple" />
      </div>
      <div>
        <label>Model</label>
        <input id="model" value="iPhone 15 Pro Max" />
      </div>
    </div>
    <label>Lens Model</label>
    <input id="lens" value="Main Camera (24 mm, f/1.78, 48 MP)" />

    <img id="preview" alt="Preview will appear here" />

    <div>
      <button class="primary" id="processBtn">Embed EXIF & Download</button>
    </div>
    <p id="status" class="muted"></p>
  </div>

  <footer>Made with piexifjs • Works offline after first load</footer>

<script src="https://cdn.jsdelivr.net/npm/piexifjs"></script>
<script>
async function readFileAsDataURL(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

const fileInput = document.getElementById("fileInput");
const preview = document.getElementById("preview");
const statusEl = document.getElementById("status");
const btn = document.getElementById("processBtn");

fileInput.addEventListener("change", async (e) => {
  const file = e.target.files?.[0];
  if (!file) return;
  const url = await readFileAsDataURL(file);
  preview.src = url;
  statusEl.textContent = `Loaded: ${file.name} (${Math.round(file.size/1024)} KB)`;
});

btn.addEventListener("click", async () => {
  const file = fileInput.files?.[0];
  if (!file) { alert("Please choose an image first."); return; }

  statusEl.textContent = "Processing and converting to JPEG...";

  const img = new Image();
  img.src = await readFileAsDataURL(file);
  await img.decode();

  // Convert to JPEG
  const canvas = document.createElement("canvas");
  canvas.width = img.width;
  canvas.height = img.height;
  const ctx = canvas.getContext("2d");
  ctx.drawImage(img, 0, 0);
  const jpegDataURL = canvas.toDataURL("image/jpeg", 0.95);

  // Embed EXIF
  let exifObj = {"0th":{}, "Exif":{}, "GPS":{}, "Interop":{}, "1st":{}};
  exifObj["0th"][piexif.ImageIFD.Make] = "Apple";
  exifObj["0th"][piexif.ImageIFD.Model] = "iPhone 15 Pro Max";
  exifObj["Exif"][piexif.ExifIFD.LensModel] = "Main Camera (24 mm, f/1.78, 48 MP)";
  const exifBytes = piexif.dump(exifObj);
  const newDataURL = piexif.insert(exifBytes, jpegDataURL);

  // Download
  const a = document.createElement("a");
  a.href = newDataURL;
  a.download = file.name.replace(/\.[^.]+$/, "") + "_exif.jpeg";
  a.click();

  statusEl.textContent = "Done! Downloaded as JPEG with EXIF.";
});
</script>

</body>
</html>
